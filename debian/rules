#!/usr/bin/make -f

DEB_AUTO_UPDATE_DEBIAN_CONTROL = true

DEB_DIVERT_EXTENSION = .grase
# Replace some base files with simple replacements.
#DEB_DIVERT_FILES_grase-conf-squid3 += \
#    /etc/logrotate.d/squid3.grase
#    /etc/squid3/squid.conf.grase
#	/etc/monit/monitrc.grase
#	/etc/issue.net.debathena \
#	/etc/mailname.debathena \
#	/etc/papersize.debathena
#DEB_TRANSFORM_FILES_grase-conf-monit += \
#	/etc/default/monit.grase \


# These files are installed via dh_install from the files/ directory
# (see debian/grase-conf-monit.install)

include /usr/share/cdbs/1/rules/debhelper.mk
#include /usr/share/cdbs/1/rules/config-package.mk

ifeq ($(shell lsb_release -cs),precise)
	DEB_DH_GENCONTROL_ARGS_ALL = -- -Vdist:Depends="squid3 (>= 3.1), squid3 (<< 3.2)"
	export SQUID_VERSION=3.1
else ifeq ($(shell lsb_release -cs),trusty)
	DEB_DH_GENCONTROL_ARGS_ALL = -- -Vdist:Depends="squid3 (>= 3.3), squid3 (<< 3.4)"
	export SQUID_VERSION=3.3
else ifeq ($(shell lsb_release -cs),xenial)
	DEB_DH_GENCONTROL_ARGS_ALL = -- -Vdist:Depends="squid (>= 3.5), squid (<< 3.6)"
	export SQUID_VERSION=3.5
else ifeq ($(shell lsb_release -cs),jessie)
	DEB_DH_GENCONTROL_ARGS_ALL = -- -Vdist:Depends="squid3 (>= 3.4), squid3 (<< 3.5)"
	export SQUID_VERSION=3.4
else
	$(error Unsupported distribution)
endif


#%:
#	dh $@


install/grase-conf-squid3::
#     dh_install --package=libfoo$(FOO_SOVERSION) lib/libfoo.so.$(FOO_SOVERSION) usr/lib/$(DEB_HOST_MULTIARCH)
	#dh_install
ifeq (${SQUID_VERSION},3.5)
	mkdir -p debian/grase-conf-squid3/etc/squid/grase.d/
	cp ${SQUID_VERSION}_files/etc/squid/squid.conf.grase debian/grase-conf-squid3/etc/squid/
	cp grase.d.README.conf debian/grase-conf-squid3/etc/squid/grase.d/
else
	mkdir -p debian/grase-conf-squid3/etc/squid3/grase.d/
	cp ${SQUID_VERSION}_files/etc/squid3/squid.conf.grase debian/grase-conf-squid3/etc/squid3/
	cp grase.d.README.conf debian/grase-conf-squid3/etc/squid3/grase.d/
	#ls debian/grase-conf-squid3/etc/squid3/
